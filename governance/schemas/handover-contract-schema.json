{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://synkra.dev/schemas/handover-contract-v1.json",
  "title": "Handover Contract Schema",
  "description": "Schema for validating handover contracts between AIOS agents. Implements the Five Trust Behaviors.",
  "version": "1.0.0",
  "type": "object",
  "required": ["from_agent", "to_agent", "artifact_type", "verification"],
  "properties": {
    "from_agent": {
      "type": "string",
      "pattern": "^@[a-z][a-z0-9-]*$",
      "description": "The agent transferring work (e.g., @pm, @sm, @architect)",
      "examples": ["@pm", "@sm", "@architect", "@dev"]
    },
    "to_agent": {
      "type": "string",
      "pattern": "^@[a-z][a-z0-9-]*$",
      "description": "The agent receiving work (e.g., @dev, @qa)",
      "examples": ["@dev", "@qa", "@sm", "@devops"]
    },
    "artifact_type": {
      "type": "string",
      "enum": ["epic", "story", "task", "document", "review", "deployment", "research"],
      "description": "The type of artifact being handed over"
    },
    "artifact_id": {
      "type": "string",
      "description": "Unique identifier for the artifact (e.g., AIOS-GOV-001, GOV-001.1)",
      "examples": ["AIOS-GOV-001", "GOV-001.1", "TASK-123"]
    },
    "artifact_path": {
      "type": "string",
      "description": "File path to the artifact document",
      "examples": ["docs/epics/AIOS-GOV-001.md", "docs/stories/GOV-001.1.md"]
    },
    "required_fields": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of fields the receiving agent must have access to",
      "examples": [["business_context", "success_metrics", "scope_boundaries"]]
    },
    "verification": {
      "type": "object",
      "description": "Verification data implementing Trust Behaviors",
      "required": ["checklist_completed", "confidence"],
      "properties": {
        "checklist_completed": {
          "type": "boolean",
          "description": "Whether the pre-handover checklist was completed (Diligent Execution)"
        },
        "checklist_path": {
          "type": "string",
          "description": "Path to the checklist used for verification",
          "examples": ["checklists/epic-ready.md", "checklists/story-complete.md"]
        },
        "confidence": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Agent's confidence level in the completeness of handover (Honest Uncertainty)"
        },
        "evidence": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of evidence items supporting the handover (Verification Before Claim)",
          "examples": [["3 stories created", "ClickUp tasks synced", "Schema validated"]]
        },
        "blockers": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Any known blockers or risks for the receiving agent (Loud Failure)"
        },
        "assumptions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Assumptions made that the receiving agent should validate"
        }
      },
      "if": {
        "properties": {
          "confidence": { "enum": ["low", "medium"] }
        }
      },
      "then": {
        "properties": {
          "evidence": {
            "minItems": 1
          }
        },
        "required": ["evidence"]
      }
    },
    "paper_trail": {
      "type": "object",
      "description": "Audit trail for the handover (Paper Trail behavior)",
      "properties": {
        "clickup_task_id": {
          "type": "string",
          "description": "ClickUp task ID for tracking",
          "examples": ["86c86efzv"]
        },
        "clickup_url": {
          "type": "string",
          "format": "uri",
          "description": "Full ClickUp task URL",
          "examples": ["https://app.clickup.com/t/86c86efzv"]
        },
        "git_commit": {
          "type": "string",
          "description": "Git commit hash or reference",
          "examples": ["abc123", "feat(gov): add handover schema"]
        },
        "git_branch": {
          "type": "string",
          "description": "Git branch name",
          "examples": ["feature/GOV-001.1-handover-schema"]
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of the handover"
        },
        "session_id": {
          "type": "string",
          "description": "Claude Code session ID for context"
        }
      }
    },
    "context": {
      "type": "object",
      "description": "Additional context for the receiving agent",
      "properties": {
        "summary": {
          "type": "string",
          "description": "Brief summary of what was done",
          "maxLength": 500
        },
        "decisions_made": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "decision": { "type": "string" },
              "rationale": { "type": "string" },
              "alternatives_considered": {
                "type": "array",
                "items": { "type": "string" }
              }
            },
            "required": ["decision", "rationale"]
          },
          "description": "Key decisions made that the receiving agent should know"
        },
        "files_modified": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of files created or modified"
        },
        "dependencies": {
          "type": "array",
          "items": { "type": "string" },
          "description": "External dependencies or blockers"
        }
      }
    },
    "next_actions": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Explicit next steps for the receiving agent",
      "examples": [["@sm: quebrar em stories", "@architect: validar schema"]]
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "schema_version": {
          "type": "string",
          "const": "1.0.0"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "expires_at": {
          "type": "string",
          "format": "date-time",
          "description": "Optional expiration for time-sensitive handovers"
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "from_agent": "@pm",
      "to_agent": "@sm",
      "artifact_type": "epic",
      "artifact_id": "AIOS-GOV-001",
      "artifact_path": "docs/epics/AIOS-GOV-001-handover-contracts.md",
      "required_fields": ["business_context", "success_metrics", "scope_boundaries", "quality_gates"],
      "verification": {
        "checklist_completed": true,
        "checklist_path": "checklists/epic-ready.md",
        "confidence": "high",
        "evidence": [
          "Epic document created with all sections",
          "ClickUp task created and linked",
          "Success criteria defined"
        ]
      },
      "paper_trail": {
        "clickup_task_id": "86c86efw9",
        "clickup_url": "https://app.clickup.com/t/86c86efw9",
        "timestamp": "2026-02-12T14:30:00Z"
      },
      "next_actions": [
        "@sm: quebrar em stories usando story-tmpl.yaml",
        "@architect: validar technical approach"
      ],
      "metadata": {
        "schema_version": "1.0.0",
        "priority": "high",
        "tags": ["governance", "handover"]
      }
    }
  ]
}
