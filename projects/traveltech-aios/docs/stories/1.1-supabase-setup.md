# Story 1.1: Supabase Project Setup

> **Epic:** 1 - Foundation
> **Status:** READY
> **Priority:** P0
> **Estimate:** 2-3 hours

---

## Objective

Set up Supabase project with database schema, authentication, and Row Level Security policies.

---

## Acceptance Criteria

- [ ] Supabase project created at supabase.com
- [ ] Database migrations executed successfully
- [ ] All tables created with correct schema
- [ ] RLS policies enabled and working
- [ ] `has_access()` function tested and working
- [ ] Environment variables documented
- [ ] Connection tested from local development

---

## Technical Notes

### 1. Create Supabase Project

1. Go to https://supabase.com/dashboard
2. Create new project: `traveltech-aios`
3. Choose region closest to target users (EU for ITB Berlin)
4. Save the credentials:
   - Project URL
   - Anon Key
   - Service Role Key

### 2. Run Migrations

```bash
# Option A: Via Supabase CLI
supabase db push

# Option B: Via Dashboard
# Copy content from migrations/*.sql and run in SQL Editor
```

### 3. Verify Schema

```sql
-- Check tables exist
SELECT table_name FROM information_schema.tables
WHERE table_schema = 'public';

-- Expected: users, products, product_access, user_products, business_dna, user_favorites, trail_progress
```

### 4. Test has_access Function

```sql
-- Insert test user and product
INSERT INTO public.users (id, email) VALUES ('test-uuid', 'test@example.com');
INSERT INTO public.user_products (user_id, product_id, status) VALUES ('test-uuid', 'hotel-aios', 'active');

-- Test function
SELECT public.has_access('test-uuid', 'experts', 'hotel'); -- Should return TRUE
SELECT public.has_access('test-uuid', 'experts', 'agency'); -- Should return FALSE
SELECT public.has_access('test-uuid', 'tools', 'all'); -- Should return TRUE (bundle includes all tools)

-- Cleanup
DELETE FROM public.user_products WHERE user_id = 'test-uuid';
DELETE FROM public.users WHERE id = 'test-uuid';
```

### 5. Environment Variables

Create `.env.local`:

```env
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## Files Changed

- `supabase/migrations/001_initial_schema.sql` (already created)
- `supabase/migrations/002_seed_products.sql` (already created)
- `.env.local` (to create)
- `.env.example` (to create)

---

## Definition of Done

- [ ] All migrations executed without errors
- [ ] RLS policies verified with test queries
- [ ] `has_access()` function returns correct results
- [ ] Environment variables set up
- [ ] README updated with setup instructions
